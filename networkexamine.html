<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link rel="stylesheet" type="text/css" href="./css/reset.css">
    <link rel="stylesheet" type="text/css" href="./css/airexamine.css">
    <title>日常检查</title>
    <style>
        .content{
            padding: 12px 10px;
            margin: 10px 8px 0;
        }
        .radioList{
            margin-top:6px;
        }

        .textareaBox{
            width:100%;
            margin-top:6px;
        }
        .contentBox{
            border-bottom: 1px dashed #ccc;
        }
        .checkbox .radiobox{
            width:50%;
        }
        .inputLable{
            display: inline-block;
            width: 126px;
        }
        .inputText{
            width:200px;
        }
        .dayInput{
            width: 60px;
            height: 26px;
            border: 1px solid #ccc;
        }
        .inputButton{
            display: flex;
            justify-content: center;
        }
        .inputButton input{
            margin-right: 15px;
        }
        .container {
            width: 100%;
            height: 100%;
        }
        #canvasBox {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .greet {
            padding: 12px;
            font-size: 20px;
            user-select: none;
        }
        .greet select {
            font-size: 18px;
        }
        canvas {
            flex: 1;
            cursor: crosshair;
            border:2px dashed lightgray;
        }
        .none{
            display: none;
        }
        #pic,#pic1{
            height: auto;
            width: 100%;
        }
        .drawButton{
            border: 1px solid #f9f9f9;
            border-radius: 10px;
            padding: 10px 16px;
            background: #fff;
            color: #232323;
            font-size: 16px;
            margin-left: 18px;
        }
    </style>
</head>
<body style="background:#f9f9f9;">
<div class="container none" >
    <div id="canvasBox" >
        <div class="greet">
            <span>请在下方空白处签名</span>
            <input type="button" class="drawButton" value="清除" ontouchstart="cleardraw()" onmousedown="cleardraw()"/>
            <input type="button" class="drawButton" value="确定" ontouchstart="savePNG()" onmousedown="savePNG()"/>
        </div>
        <canvas></canvas>
    </div>
</div>
<div id="examine">
    <div class="contentTitle">网络安全执法检查表</div>

    <div class="content">
        <div class="radioContent checkbox">
            <p class="radioTitle font14">检查范围：</p>
            <div class="flex" id="ischange">
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="1">
                    <label></label>
                    <span class="font14">网络安全等级保护</span>
                </div>
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="2">
                    <label></label>
                    <span class="font14">网站</span>
                </div>
            </div>
            <div class="flex">
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="3">
                    <label></label>
                    <span class="font14">非经营性上网服务场所</span>
                </div>
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="4">
                    <label></label>
                    <span class="font14">经营性上网服务场所</span>
                </div>
            </div>
            <div class="flex">
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="5">
                    <label></label>
                    <span class="font14">电子显示屏</span>
                </div>
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="6">
                    <label></label>
                    <span class="font14">电子邮件</span>
                </div>
            </div>
            <div class="flex">
                <div class="radiobox font14">
                    <input type="checkbox" name="j1" value="7">
                    <label></label>
                    <span class="font14">其他</span>
                </div>
            </div>
        </div>
        <div class="radioList">
            <div class="title">
                <span class="lineBox"></span><span class="font14 titletext fontWeight">基本情况</span>
            </div>
            <div class="inputBox">
                <span class="font14 inputLable">网络安全管理机构：</span>
                <input  class="inputText font14 w2" onchange="changeValue('w2')" type='text' placeholder="网络安全管理机构"/>
            </div>
            <div class="inputBox">
                <span class="font14  inputLable">网络安全负责人：</span>
                <input  class="inputText font14 w3" onchange="changeValue('w3')" type='text' placeholder="网络安全负责人"/>
            </div>
            <div class="inputBox">
                <span class="font14 inputLable">网络安全联络员：</span>
                <input  class="inputText font14 w4" onchange="changeValue('w4')" type='text' placeholder="网络安全联络员"/>
            </div>
            <div class="inputBox">
                <span class="font14 inputLable">网络安全管理制度：</span>
                <input  class="inputText font14 w5" onchange="changeValue('w5')" type='text' placeholder="网络安全管理制度"/>
            </div>
        </div>
        <div class="contentBox"></div>
        <div class="radioContent" style="margin-top:5px;">
            <div class="font14">在本次检查中存在的网络安全隐患以及相关具体问题如下：</div>
            <textarea class="textareaBox font14 z11" onchange="changeValue('z11')" placeholder="多行输入"></textarea>
        </div>
        <div class="radioContent font14">
            请你单位根据以上具体问题，结合本单位工作实际在<input type='tel' class='dayInput g12' onchange="changeValue('g12')" /> 工作日内进行整改，结果形成书面材料函告我单位。
        </div>
    </div>
    <div class="contentOne">
        <div class="title">
            <span class="lineBox"></span>
            <span class="font16 titletext fontWeight" >签字</span>
        </div>
        <div class="flexBetween signBox">
            <div class="font14">检查员签字:</div>
            <div  class="signButton checkbutton" onclick="showsign()">请手写签名</div>
        </div>
        <img id="pic" src=""/>
        <div class="flexBetween signBox">
            <div class="font14">被检查人签字:</div>
            <div  class="signButton checkbutton1" onclick="showsign1()">请手写签名</div>
        </div>
        <img id="pic1" />
    </div>
    <div class="smallButton" onclick="submit()">提交</div>
</div>
<div id="tanwin" class="tan" style="display:none;"></div>
<div class="zhegaicengone zhegaiceng" style="display: none;">
    <img class='lodingimg' src="./images/loadingpop.gif">
</div>

</body>
<script src="./js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="./js/commen.js" type="text/javascript" charset="utf-8"></script>
<script src="./js/networkexamine.js" type="text/javascript" charset="utf-8"></script>
<script src="./js/draw.js" type="text/javascript" charset="utf-8"></script>
</html>
<script>
    var j13 = '',b14 = '';
    function savePNG() {
        signImage = draw.getPNGImage();
        $('.container').addClass('none');
        $("#examine").removeClass('none');
        var bzrPhoto = signImage;
        var index = bzrPhoto.indexOf(',');
        if(sign == 1){
            $("#pic").attr("src",signImage)
            j13 = bzrPhoto.substring(index+1);
        }
        if(sign == 2){
            $("#pic1").attr("src",signImage)
            b14 = bzrPhoto.substring(index+1);
        }
    }
    var inputobj = {
        w2: '',
        w3: '',
        w4: '',
        w5: '',
        z11: '',
        g12: ''
    }
    var radioobj = {
        s6: '',
        s7: '',
        s8: '',
        s9: '',
        s10: ''
    }
    $(function(){
        if(localStorage.getItem('checkBoxValue')){
            setTheCheckBoxValue()
        }
        if(localStorage.getItem('networkInput')){
            setinputValue()
        }
        if(localStorage.getItem('networkradio')){
            setradioValue()
        }
        changeRadio();
        $('input:checkbox').click(function () {
            getTheCheckBoxValue();
        });
    })
    //监听radio
    function changeRadio(){
        $.each(radioobj, function(key, val) {
            $("input:radio[name='"+key+"']").change(function () {
                if(JSON.parse(localStorage.getItem('networkradio'))){
                    radioobj = JSON.parse(localStorage.getItem('networkradio'))
                }
                radioobj[key] = $("input[name='"+key+"']:checked").val();
                localStorage.setItem('networkradio',JSON.stringify(radioobj))
            })
        });
    }
    //回显radio
    function setradioValue(){
        var  networkradio = JSON.parse(localStorage.getItem('networkradio'));
        $.each(networkradio, function(key, val) {
            if(networkradio[key]){
                $("input[name='"+key+"'][value='"+networkradio[key]+"']").attr('checked','true');
            }
        });
    }
    //监听存input text
    function changeValue(k){
        if(localStorage.getItem('networkInput')){
            inputobj = JSON.parse(localStorage.getItem('networkInput'));
        }
        inputobj[k] = $("."+k).val();
        localStorage.setItem('networkInput',JSON.stringify(inputobj))
    }
    //回显input text
    function setinputValue(){
        var inputVal = JSON.parse(localStorage.getItem('networkInput'));
        $.each(inputVal,function(key,val){
            $("."+key).val(inputVal[key])
        })
    }
    //回显多选框的值
    function setTheCheckBoxValue(){
        var checkBoxValue = localStorage.getItem('checkBoxValue')
        var checkBoxArray = checkBoxValue.split(",");
        for(var i=0;i<checkBoxArray.length;i++){
            $("input[name='j1']").each(function(){
                if($(this).val() == checkBoxArray[i]){
                    $(this).attr("checked","checked");
                }
            })
        }
    }
    //多选框取值存储
    function getTheCheckBoxValue() {
        var test = $("input[name='j1']:checked");
        var checkBoxValue = "";
        test.each(function () {
            checkBoxValue += $(this).val()+',';
        })
        checkBoxValue = checkBoxValue.substring(0, checkBoxValue.length - 1);
        console.log(checkBoxValue)
        localStorage.setItem('checkBoxValue',checkBoxValue);
    }
    function submit(){
        var j1 = '';
        if(localStorage.getItem('checkBoxValue')){
            j1 = localStorage.getItem('checkBoxValue')
        }
        if(localStorage.getItem('networkInput')){
            inputobj = JSON.parse(localStorage.getItem('networkInput'));
        }
        if(localStorage.getItem('networkradio')){
            radioobj = JSON.parse(localStorage.getItem('networkradio'));
        }
        var obj = {
            applyNum: applyNum,
            j1: j1,
            j13: j13,
            b14: b14
        }
        var data = Object.assign(obj,inputobj,radioobj);
        console.log(data)
        data = JSON.stringify(data)
        $.ajax({
            url: ajaxUrl + 'supervisionTemplate/waWlaqzfCheckList',
            timeout: timeDelay,
            type: 'post',
            contentType: 'application/json;charset=utf-8',
            dataType: "json",
            data: data,
            success: function(response) {
                $(".zhegaiceng").css({'display': 'none'})
                if(response.rescode == 200){
                    localStorage.removeItem('networkradio')
                    localStorage.removeItem('networkInput')
                    localStorage.removeItem('checkBoxValue')
                    window.postMessage('success');//向app发送提交成功消息
                }else{
                    toast(response.resdes)
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                $(".zhegaiceng").css({'display': 'none'})
            },
            complete : function(XMLHttpRequest,status){ //请求完成后最终执行参数
                $(".zhegaiceng").css({'display': 'none'})
            }
        });
    }
</script>
</html>